{% extends "base.html" %}

{% block content %}
  <div>
    <button id="add-student" class="my-0 me-2 btn d-inline-block">+ Add student</button>
    <a href="{{ url_for('tutors') }}" class="m-0 btn py-2 sec">Tutors</a>
  </div>


  <form id="add-student-form" class="hidden-form" action="" method="post">
    <h1 class="mb-3 d-inline-block">Add student</h1>
    <a id="hide-form" href="#">Hide</a>

    {{ form.hidden_tag() }}

  </form>
  {% for status in statuses %}
    <h1 class="slide-toggle mt-4">{{ status.title() }} students</h1>

    <div id="{{ status }}-students" class="student-list">
      {% for s in students %}
        {% if s.status == status %}
          <div class="row justify-content-centered">
            <div class="col-9 col-md-10">
              <h2 class="my-1">{{ s.student_name }} {{ s.last_name }}</h2>

              {% if status == 'active' %}
                <ul class="mb-3">
                  <li>{{ s.student_email }}</li>
                  <li>Parent: {{ s.parent_name }} ({{ s.parent_email }})</li>
                  {% if s.secondary_email %}
                    <li>Email 2: {{ s.secondary_email }}</li>
                  {% endif %}
                  <li>Tutor: {{ s.tutor.first_name }} {{ s.tutor.last_name }}</li>
                  <li>Timezone:
                    {% if s.timezone == -2 %}
                        Pacific
                      {% elif s.timezone == -1 %}
                          Mountain
                      {% elif s.timezone == 0 %}
                          Central
                      {% elif s.timezone == 1 %}
                          Eastern
                      {% else %}
                          {{ s.timezone }}
                    {% endif %}
                  </li>
                  <li>Location: {{ s.location }}</li>
                </ul>
              {% endif %}
            </div>

            <div class="col-3 col-md-2 text-end">
              <a class="edit btn sec" href="{{ url_for('edit_student', id=s.id) }}">
                Edit
              </a>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% endfor %}
{% endblock content %}

{% block end_scripts %}
  <script>
    const slideDown = element => element.style.height = `${element.scrollHeight}px`;
    const slideUp = element => element.style.height = 0;

    let slideToggle = (target) => {
      var style = window.getComputedStyle(target),
          height = style.getPropertyValue('height');
      if (height == '0px') {
        return slideDown(target);
      } else {
        return slideUp(target);
      }
    }

    document.getElementById("add-student").addEventListener("click", function () {
      this.parentElement.style.display = "none";
      slideDown(document.getElementById("add-student-form"));
    });

    var elements = document.getElementsByClassName("slide-toggle");

    Array.from(elements).forEach(function(element) {
      element.addEventListener("click", function () {
          slideToggle(element.nextElementSibling);
        });
    });

    document.getElementById("hide-form").addEventListener("click", function () {
      slideUp(this.parentElement);
      document.getElementById("add-student").parentElement.style.display = "block";
    });
  </script>
{% endblock end_scripts %}
